<!-- HOLE NUMBER 1 -->



<style type="text/css">
/* #map_canvas {width: 200px; height: 300px;} */
</style>

<!-- begin page -->
<div data-role="page" id="hole_detail">


<div id="map_canvas"></div>

<!-- begin content -->
<div data-role="content">

<h1> Hole #<%- hole_id %> </h1>


<div data-role="navbar" data-iconpos="top">
<ul>
<!-- <li><a href="#" data-theme="a" data-icon="plus" data-role="button">Zoom</a></li> -->

<% if (parseInt(hole_id) > 1) { %>
<li>
<h2>
	<a id="holeprev" href="/hole_detail/<%- course_id %>/<%- (parseInt(hole_id) - 1)  %>" data-ajax="false" data-theme="a" data-icon="arrow-l" data-role="button">&nbsp;HoleNumber</a></li></h2>
<% } %>


<% if (parseInt(hole_id) < 5) { %>
<li>
<h2>
	<a id="holenext" href="/hole_detail/<%- course_id %>/<%- (parseInt(hole_id) + 1)  %>" data-ajax="false" data-theme="a" data-icon="arrow-r" data-role="button">&nbsp;HoleNumber</a></li></h2>
<% } %>
</ul>
</div>

</div>
<!-- end content -->

<!-- begin page footer -->
<div data-theme="a" data-role="footer">
<img style="width: 100%;" src="/assets/img/footer.jpg" />
</div>
<!-- end page footer -->

</div>
<!-- end page -->

<!-- begin script -->
<script charset="UTF-8" type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0">
</script>
<script charset="UTF-8" type="text/javascript" src="/assets/js/math.js">
</script>
<script type="text/javascript">

var map, mapOptions, centerLat, centerLng, holeLat, holeLng, teeLat, teeLng, mapCenter, hole, mapBounds;

//$(document).ready(function(){
$(document).bind('pageinit', function(){

	$.ajax({
		url: '/hole/' + <%- hole_id %>,
		dataType: 'json',
		success: holeResponse
	});

	$.ajax({
		url: '/tee/byholeid/' + <%- hole_id %>,
		dataType: 'json',
		success: teeResponse
	});

	function holeResponse(result) {
		hole = result.rows[0];
		//alert('hole_lat = ' + hole.hole_lat);
		holeLat = hole.hole_lat;
		holeLng = hole.hole_lng;
		checkDataReady();
	}

	function teeResponse(result) {
		var tee = result.rows[0];
		//alert('tee_lat = ' + tee.lat);
		teeLat = tee.lat;
		teeLng = tee.lng;
		checkDataReady();
	}

	function checkDataReady() {
		if (
			(typeof holeLat != 'undefined')	&&
			(typeof holeLng != 'undefined')	&&
			(typeof teeLat != 'undefined')	&&
			(typeof teeLng != 'undefined')
		) {
			drawMap(holeLat, holeLng, teeLat, teeLng);
		}
	}

	function drawMap(hLat, hLng, tLat, tLng) {
		if (parseInt(hole.hole_number) < 5) {
			$('#holenext').text('Hole #' + (parseInt(hole.hole_number) + 1))//button('refresh');
		}
		if (parseInt(hole.hole_number) > 1) {
	
			$('#holeprev').text('Hole #' + (parseInt(hole.hole_number) - 1));
		}
		
		//calculate center of map
		centerLat = (holeLat + teeLat) / 2;
		centerLng = (holeLng + teeLng) / 2;
		mapCenter = new Microsoft.Maps.Location(centerLat, centerLng);

		var hLoc = new Microsoft.Maps.Location(hLat, hLng);
		var tLoc = new Microsoft.Maps.Location(tLat, tLng);
		var locationRect = new Microsoft.Maps.LocationRect.fromLocations(hLoc, tLoc);
		var rotationDeg = calculateDegree(hLat, hLng, tLat, tLng);
		//alert("rotationDeg: " + rotationDeg);

		/*
		* This code is incomplete!
		*  -Rotation is hardcoded.
		*  -Ruler lines aren't done.
		*  -Text for markers need to be moved into an InfoBox
		*/

		mapOptions = {
			credentials: "Arq11YoPO5TewSANz0EobO8TjY6-YNqIXMJkDuYg231yc_loLnZ2iO9k03ajn82A",
			//mapTypeId: Microsoft.Maps.MapTypeId.aerial,
			mapTypeId: Microsoft.Maps.MapTypeId.auto,
			//center: mapCenter,
			bounds: locationRect,
			heading: 90,
			animate: false,
			zoom:18,
			disablePanning: true,
			enableSearchLogo: false,
			showDashboard: false,
			showScalebar: false,
			showCopyright: false, //TODO: We are required to display this elsewhere in the app
			height: 400, //bing wasn't respecting our div size.  not sure why.
			width: 300,

		}


		map = new Microsoft.Maps.Map(document.getElementById("map_canvas"), mapOptions);

		var targetPin = new Microsoft.Maps.Pushpin(hLoc, {draggable: true, text: "327yds"});
		var mePin = new Microsoft.Maps.Pushpin(tLoc, {draggable: true, text: "me"});

		//var distIB = new 

		map.entities.push(targetPin);
		map.entities.push(mePin);

		//I tried every map type and checked this property.  Nothing seemed to enable rotation.
		//alert("map isRotationEnabled: " + map.isRotationEnabled() );
	}

	function addBingRuler() {
	}


});

</script>
<!-- end script -->

